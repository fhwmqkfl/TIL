# 세션과 쿠키 + 캐시

## Intro
> Http 특징에 기반한 쿠키와 세션의 대두
> 
> <img src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbetTb6%2FbtqxVesqYq0%2FsUO2b5dpKqVuR261lNZBKk%2Fimg.png">
 
HTTP 프로토콜의 특성
* 비연결성(Connectionless) : 클라이언트가 요청을 한 후 응답을 받으면 연결을 끊음
* Stateless : 통신이 끝나면 상태를 유지하지 않는다.

위의 HTTP 프로토콜의 특성상 통신이 연결되지 않기 때문에 매번 유저가 새로 인증을 해야하는 번거로움이 생겼고<br>
이 번거로운방법을 해결하기위한 방법으로 쿠키와 세션이 나왔다.

## 쿠키(Cookie)
- 서버가 웹 브라우저(클라이언트)에 전송하는 작은 데이터 파일로 `웹 브라우저가 저장`했다가 필요시 정보를 참조하거나 재사용할 수 있다.
- 서버에서 어떤 요청이 브라우저에 들어왔는지를 판단할 때 사용하기도 한다.
- 웹사이트에서는 쿠키를 통해 어떤 기기로 접속했는지 인식하고, 일부 데이터를 저장한디.
- 만료일을 지정할 수 있고, 만료일이 지나면 삭제된다
- 이름, 값, 만료일, 경로 정보로 구성되어 있으며 
- 클라이언트에 총 300개까지 쿠키 저장가능


### 쿠키 동작 방식
<img src="https://miro.medium.com/max/720/1*fWfKsO9P2rReNzJM2doBhQ.png">

1. 클라이언트가 서버에 로그인 요청
2. 서버는 쿠키를 생성하고 요청을 처리한다. 이후 응답 헤더에 `set-cookie`를 추가해서 응답
3. `클라이언트`는 이 쿠키를 `자기 pc`에 저장하고, 다음부터 서버에 요청할 때, 쿠키를 `헤더`에 추가해서 요청한다.
4. 서버는 쿠키를 보고 클라이언트에 응답한다


## 세션(Session)

세션은 일정 시간 동안, 클라이언트로부터 들어오는 일련의 요구를 하나의 상태로 보고, 그 상태를 유지시키는 기술이다.<br>
(일정 시간 : 유저가 브라우저를 통해 접속한 시점 ~ 브라우저 종료로 연결 끊는 시점)

- 쿠키와 달리 세션은 `웹 서버에 저장`된다
- (서버 용량의 가용량 안에서) 저장 데이터의 제한이 없다 -> 사용자가 많아질 경우 서버 메모리 부담이 늘어나 성능 저하로 이어질 수도 있다
- 각 클라이언트가 접속시 부여되는 세션ID가 있는데, 이를 사용해 클라이언트를 구분한다.
- 브라우저가 딛히거나, 서버에서 세션을 삭제할때 세션이 삭제되기때문에, 쿠키보다 비교적 보안이 좋다.
- 서버에 저장되기 떄문에 사용자 정보를 노출하지 않을 수 있다.

### 세션 동작 방식
<img src="https://miro.medium.com/max/720/1*oiHghHg3sQW5ynmMCAtPAA.png">

1. 클라이언트가 서버로 로그인 요청
2. 서버는 접근한 클라이언트의 쿠키를 확인해서, 클라이언트가 해당 `SessionID`를 보내왔는지 확인한다
3. 만일 보내지 않았다면, 서버는 새롭게 SessionID를 생성, 클라이언트에 `set-cookie`값으로 `SessionID`를 보낸다.
4. 그 다음 요청부터, 전달 받은 `SessionID` 쿠키를 자동으로 헤더에 추가해서 요청한다.
5. 요청 헤더의 `SessionID`값을 저장된 세션 저장소에서 찾아보고 유효한지 확인 후 요청을 처리하고 응답해준다.


## 쿠키와 세션의 차이점
|특징|쿠키|세션|
|:---:|---|---|
|저장위치|로컬 | 서버 |
|보안   |탈취, 변조 가능| 서버에 저장되어 상대적으로 안전함|
|생명주기|브라우저 종료해도 남음(만료일이 있음)| 브라우저 **종료시** 세션이 삭제된다 |
|속도   |파일에서 읽기 때문에 빠르다| 요청마다 서버에서 처리하기때문에 비교적 느리다 |

세션의 경우 서버의 자원을 사용하기 때문에 무분별하게 만들면, 서버의 메모리에 영향을 주게 된다.<br>
따라서 경우에 따라 쿠키와 세션을 적절히 사용해야 함


## 캐시
- 자주 사용하는 데이터나 값을 미리 복사해놓은 곳으로
- 저장공간은 작으나 성능이 매우 빠르다
- 캐시에 데이터를 미리 메모리에 저장해 놓으면 매우 빠르게 접근이 가능하다

요청의 결과 값은 jpg, png, css, js, 배너 등 변경 사항이 크지 않고, 용량이 큰 파일들이다.<br>
이런 데이터는 다시 사용될 가능성이 높고 매번 다시 다운받으려면 시간이 오래 걸리기 때문에 저장소(캐시)에 저장하고 다시 재사용한다 -> 페이지 로딩 속도가 빨라진다.