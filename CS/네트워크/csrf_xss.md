# CSRF & XSS

## XSS(Cross-Site Scripting)
> CSS라고 줄이는게 맞지만 이미 통용되는 CSS가 있어 XSS로 불림
> 
사이트에 스크립트를 심어 넣는 공격 기법 <br>
클라이언트가 사이트에 접속시 심어놓은 악성 스크립트가 클라이언트에서 실행되며 피해가 발생한다.<br>
`사용자가 특정 웹사이트를 신용하는 점을 노린 공격`이다

><img src="https://t1.daumcdn.net/cfile/tistory/230DC54B58C4E00716">
>
><img src="https://t1.daumcdn.net/cfile/tistory/240BE14B58C4E0060D">
>위의 이미지 처럼 스크립트를 심으면 
>
><img src="https://t1.daumcdn.net/cfile/tistory/25533D4B58C4E00512">
>스크립트가 실행된다!

대부분의 해킹공격 기범은 서버단이지만, XSS는 `클라이언트를 대상`으로 한 공격이다

### XSS의 종류
공격 방법에 따라 **Stored XSS**와 **Reflected XSS**로 나뉜다.
- Stored XSS :  사이트 게시판이나 댓글, 닉네임 등 스크립트가 서버에 저장되어 실행되는 방식. <br> ex) 특정 블로그 댓글에 악성코드를 남겨 방문하는 사람들 모두 악성코드의 피해자가 될 수 있
- Reflected XSS :  보통 URL 파라미터(특히 GET 방식)에 스크립트를 넣어 서버에 저장하지 않고 그 즉시 스크립트를 만드는 방식<br>Reflected XSS의 경우 브라우저 자체에서 차단하는 경우가 많아 상대적으로 공격을 성공시키기 어렵다.

### XSS로 인해 발생하는 피해들
1. 쿠키 정보 및 세션 ID 획득 <br>
   공격자가 XSS공격을 통해 해당 페이지를 이용하는 사용자의 쿠키 정보나 세션 ID를 획득할 수 있다. 획득시 공격자가 불법적으로 정상 사용자인 척 가장할 수 있다.
2. 시스템 관리자 권한 획득 <br>
   사용자의 시스템을 통제해 회사의 개인 PC가 해킹될 경우, 조직내부의 정보가 탈취될 수 있다
3. 악성 코드 다운로드 <br>
   XSS자체는 악성코드를 다운로드 할 수 없으나, URL을 클릭하도록 유도해 악성 프로그램을 다운로드하는 링크로 리다이렉트 시키도록 유도 할 수 있다
4. 거짓 페이지 노출 <br>
   자바스크립트를 이용해 전혀 다른 페이지를 표시할 수 있다.

### XSS 방지법
- 문자를 필터링한다. XSS 공격은 입력값에 대한 검증이 제대로 이뤄지지 않아 발생하는 것이므로 사용자의 모든 입력값에 대해 서버측에서 필터링 해주어야 한다.
- 입력값에 대해 정규식을 이용해 정확하게 허용하는 패턴의 데이터만 입력되도록 처리한다.
- 출력값에 대해 HTML 인코딩을 적용해 스크립트가 동작되지 않도록 한다.

## CSRF(Cross Site Request Fogery), 사이트간 요청 위조
사용자가 자신의 의지와는 무관하게 공격자가 의도한 행위를 특정 웹사이트에 요청하게 하는 공격<br>
`특정 웹사이트가 사용자의 웹 브라우저를 신용하는 점을 노린 공격`으로 옥션에서 발생한 개인정보 유출사건의 원인이 이 공격기법이다.<br>
사용자가 로그인한 상태에서 특정 피싱사이트를 열면, 로그인된 사이트에 위조된 공격명령이 가게되는데 이때 사이트는 안전한 사용자라고 생각해 그대로 공격에 노출된다<br>
(ex:구글 자동로그인 상태로 피싱사이트 접속하면 구글에 내 계정으로 스미싱이나 스팸메세지를 자동으로 보내게 됨)

CSRF공격이 성공하기위해서는 다음의 조건을 만족해야 한다
* 위조 요청을 전송하는 서비스(ex:구글)에 사용자가 로그인된 상태
* 그 상황에서 피싱사이트에 접속해야함

### CSRF 방지법
1. Request의 referrer을 확인하여 도메인이 일치하는지 검증한다
   -> 대다수의 csrf공격은 여기서 방어된다. 
2. Security Token 사용(1번이 어려운 경우)
   사용자 세션에 임의의 난수 값을 저장하고, 요청마다 해당 난수 값을 포함시켜 전송시킨다 <br> 
   이후 요청을 받을 때마다 세션에 저장된 토큰 값과 요청 파라메터로 전달되는 토큰 값 일치여부를 확인한다

